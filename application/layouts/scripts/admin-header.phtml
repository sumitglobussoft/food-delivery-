<?php echo $this->doctype(); ?>
<html lang="en-US">  
    <head>
        <link rel="stylesheet" href="//cdn.datatables.net/1.10.10/css/jquery.dataTables.min.css"/>
        <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
        <script src="//cdn.datatables.net/1.10.10/js/jquery.dataTables.min.js"></script>
        <?php
        # Title
        echo $this->headTitle();

        # Meta data
        echo $this->headMeta();

        # CSS
        echo $this->headLink()
//                ->appendStylesheet($this->baseUrl() . $this->appSetting->assestPath . 'admin/serversideprocessing/css/jquery.dataTables.min.css')
//                ->appendStylesheet($this->baseUrl() . $this->appSetting->assestPath . 'admin/serversideprocessing/css/scroller.dataTables.min.css')
                ->appendStylesheet($this->baseUrl() . $this->appSetting->assestPath . 'admin/css/animate.min.css')
                ->appendStylesheet($this->baseUrl() . $this->appSetting->assestPath . 'admin/css/plugin.min.css')
                ->appendStylesheet($this->baseUrl() . $this->appSetting->assestPath . 'admin/css/widget.min.css')
                ->appendStylesheet($this->baseUrl() . $this->appSetting->assestPath . 'admin/css/admin.min.css')
                ->appendStylesheet($this->baseUrl() . $this->appSetting->assestPath . 'admin/css/select2.min.css')
                ->appendStylesheet($this->baseUrl() . $this->appSetting->assestPath . 'admin/css/jasny-bootstrap.min.css')
                ->appendStylesheet($this->baseUrl() . $this->appSetting->assestPath . 'admin/css/custom.css');
//     print_r($this->appSetting->assestPath);
        if ($this->auth->hasIdentity()) {
            if ($this->session->storage->role == 2) {
                echo $this->headScript()
                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/jquery-1.9.1.min.js', 'text/javascript')
                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/jquery-migrate-1.1.0.min.js', 'text/javascript')
                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/jquery-core.js', 'text/javascript')
                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/jquery-ui-core.js', 'text/javascript')
//                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/bootstrap.min.js', 'text/javascript')
                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/dropdown.js', 'text/javascript')
                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/tooltip.js', 'text/javascript')
                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/collapse.js', 'text/javascript')
                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/superclick.js', 'text/javascript')
                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/slimscroll.js', 'text/javascript')
                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/slidebars.js', 'text/javascript')
                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/material.js', 'text/javascript')
                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/ripples.js', 'text/javascript')
                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/select2.full.min.js', 'text/javascript')
                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/jasny-bootstrap.min.js', 'text/javascript')
                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/custom.js', 'text/javascript')
                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/layout.js', 'text/javascript')
                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/datatable-bootstrap.js', 'text/javascript')
                        ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/time/time_ago.js', 'text/javascript');
//                       
            }
        } else {
            echo $this->headScript()
                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/jquery-1.9.1.min.js', 'text/javascript')
                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/jquery-migrate-1.1.0.min.js', 'text/javascript')
                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/jquery-core.js', 'text/javascript')
                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/jquery-ui-core.js', 'text/javascript')
//                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/bootstrap.min.js', 'text/javascript')
                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/dropdown.js', 'text/javascript')
                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/tooltip.js', 'text/javascript')
                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/collapse.js', 'text/javascript')
                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/superclick.js', 'text/javascript')
                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/slimscroll.js', 'text/javascript')
                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/slidebars.js', 'text/javascript')
                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/material.js', 'text/javascript')
                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/ripples.js', 'text/javascript')
                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/select2.full.min.js', 'text/javascript')
                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/jasny-bootstrap.min.js', 'text/javascript')
                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/custom.js', 'text/javascript')
                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/layout.js', 'text/javascript')
                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/js/datatable-bootstrap.js', 'text/javascript')
                    ->appendFile($this->baseUrl() . $this->appSetting->assestPath . 'admin/time/time_ago.js', 'text/javascript');
        }
        ?>  
        <style>
            #sb-site {
                min-height: auto !important;
            }
        </style>
        <script>
//            $(window).load(function() {
//                setTimeout(function() {
//                    $('#loading').fadeOut(400, "linear");
//                }, 300);
//            });
        </script>
    </head> 
    <body>
        <?php
        if ($this->auth->hasIdentity()) {
            if ($this->session->storage->role == 2) {
                ?>
                <div id="sb-site">
                    <?php
                }
            }
            ?>

            <div id="loading">
                <div class="svg-icon-loader"><img src="/assets/admin/images/bars.svg" width="40" alt=""></div>
            </div>

            <?php
            if ($this->auth->hasIdentity()) {
                if ($this->session->storage->role == 2) {
                    ?>

                    <div id="page-wrapper">
                        <div id="mobile-navigation">
                            <button id="nav-toggle" class="collapsed" data-toggle="collapse" data-target="#page-sidebar"><span></span></button>
                        </div>
                        <div id="page-sidebar">
                            <div id="header-logo" class="logo-bg">
                                <a href="/admin" class="logo-content-big" title="Ziingo">Ziingo <i>UI</i> <span>Dashboard</span></a>
                                <a href="/admin" class="logo-content-small" title="Ziingo">Ziingo <i>UI</i> <span>Dashboard</span></a>
                                <a id="close-sidebar" href="#" title="Close sidebar"><i class="glyph-icon icon-outdent"></i></a>
                            </div>
                            <div class="scroll-sidebar">
                                <ul id="sidebar-menu">
                                    <li class="header"><span>Overview</span></li>
                                    <li>
                                        <a href="/admin/dashboard" title="Dashboard">
                                            <i class="glyph-icon icon-linecons-tv"></i> <span>Dashboard</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);" title="Users">
                                            <i class="glyph-icon icon-linecons-user"></i> <span>Users</span>
                                        </a>
                                        <div class="sidebar-submenu">
                                            <ul>
                                                <li><a href="/admin/userdetails" title="User Details"><span>User Details</span></a></li>
                                                <li><a href="/admin/add-user-details" title="Add New User"><span>Add New User</span></a></li>
                                            </ul>
                                        </div>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);" title="Agents">
                                            <i class="glyph-icon icon-linecons-shop"></i> <span>Agents</span>
                                        </a>
                                        <div class="sidebar-submenu">
                                            <ul>
                                                <li><a href="/admin/agent-details" title="Agent Details"><span>Agent Details</span></a></li>
                                                <li><a href="/admin/add-agents" title="Add New Agent"><span>Add New Agent</span></a></li>
                                            </ul>
                                        </div>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);" title="Grocery Details">
                                            <i class="glyph-icon icon-linecons-shop"></i> <span>Grocery Details</span>
                                        </a>
                                        <div class="sidebar-submenu">
                                            <ul>
                                                <li><a href="/admin/grocery-details" title="Grocery Details"><span>Grocery Details</span></a></li>
        <!--                                                <li><a href="/admin/add-hotel-details" title="Add New Hotel"><span>Add New Hotel Details</span></a></li>-->
                                                <li><a href="/admin/grocery-category-details" title="Category Details"><span>Grocery Category Details</span></a></li>
                                            </ul>
                                        </div>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);" title="Hotel Details">
                                            <i class="glyph-icon icon-linecons-shop"></i> <span>Hotel Details</span>
                                        </a>
                                        <div class="sidebar-submenu">
                                            <ul>
                                                <li><a href="/admin/hotel-details" title="Hotel Details"><span>Hotel Details</span></a></li>
        <!--                                                <li><a href="/admin/add-hotel-details" title="Add New Hotel"><span>Add New Hotel Details</span></a></li>-->
                                            </ul>
                                        </div>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);" title="Products">
                                            <i class="glyph-icon icon-linecons-cup"></i> <span>Product Details</span>
                                        </a>
                                        <div class="sidebar-submenu">
                                            <ul>
                                                <li><a href="/admin/product-details" title="Product Details"><span>Product Details</span></a></li>
        <!--                                                <li><a href="/admin/add-product-details" title="Add New Product"><span>Add New Product</span></a></li>-->
                                            </ul>
                                        </div>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);" title="Order Details">
                                            <i class="glyph-icon icon-linecons-note"></i> <span>Order Details</span>
                                        </a>
                                        <div class="sidebar-submenu">
                                            <ul>
                                                <li><a href="/admin/order-details" title="Order Details"><span>Order Details</span></a></li>
        <!--                                                <li><a href="/admin/refund-request" title="Test Order Details"><span>Test Order Details</span></a></li>-->
                                            </ul>
                                        </div>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);" title="Transaction Details">
                                            <i class="glyph-icon icon-linecons-money"></i> <span>Transaction Details</span>
                                        </a>
                                        <div class="sidebar-submenu">
                                            <ul>
                                                <li><a href="/admin/admin-user-transactions" title="User Transactions"><span>User Transactions</span></a></li>
                                                <li><a href="/admin/admin-agent-transactions" title="Agent Transactions"><span>Agent Transactions</span></a></li>
                                                <li><a href="/admin/admin-product-transactions" title="Product Transactions"><span>Product Transactions</span></a></li>
                                            </ul>
                                        </div>
                                    </li>                                                                                                 
                                    <li>
                                        <a href="javascript:void(0);" title="Delivery Guys">
                                            <i class="glyph-icon icon-linecons-truck"></i> <span>Delivery Guy Details</span>
                                        </a>
                                        <div class="sidebar-submenu">
                                            <ul>
                                                <li><a href="/admin/delivery-guys-details" title="Delivery Guys Details"><span>Delivery Guy Details</span></a></li>
                                                <li><a href="/admin/add-delivery-guy" title="Add New Delivery Guy"><span>Add New Delivery Guy</span></a></li>
                                                <li><a href="/admin/delivery-guy-order-logs" title="Delivery Guys Order Logs"><span>Delivery Guys Order Logs</span></a></li>
                                            </ul>
                                        </div>
                                    </li>                                 
                                    <li>
                                        <a href="javascript:void(0);" title="Notification">
                                            <i class="glyph-icon icon-linecons-cog"></i> <span>Notification</span>
                                        </a>
                                        <div class="sidebar-submenu">
                                            <ul>
                                                <li><a href="/admin/notification-log" title="Notification Log"><span>Notification Log</span></a></li>
                                                <li><a href="/admin/send-user-notification" title="Send User Notification"><span>Send User Notification</span></a></li>
                                                <li><a href="/admin/send-agent-notification" title="Send Agent Notification"><span>Send Agent Notification</span></a></li>

                                            </ul>
                                        </div>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);" title="Review">
                                            <i class="glyph-icon icon-linecons-cog"></i> <span>Reviews</span>
                                        </a>
                                        <div class="sidebar-submenu">
                                            <ul>
                                                <li><a href="/admin/hotel-reviews" title="hotel-review"><span>Hotel Reviews</span></a></li>
                                                <li><a href="/admin/grocery-reviews" title="grocery-review"><span>Grocery Reviews</span></a></li>


                                            </ul>
                                        </div>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);" title="Settings">
                                            <i class="glyph-icon icon-linecons-cog"></i> <span>Settings</span>
                                        </a>
                                        <div class="sidebar-submenu">
                                            <ul>
                                                <li><a href="/admin/category-details" title="Category Details"><span>Category Details</span></a></li>
                                                <li><a href="/admin/cuisines-details" title="Cuisine Details"><span>Cuisine Details</span></a></li>
                                                <li><a href="/admin/countries-details" title="Country Details"><span>Country Details</span></a></li>
                                                <li><a href="/admin/states-details" title="State Details"><span>State Details</span></a></li>
                                                <li><a href="/admin/city-details" title="City Details"><span>City Details</span></a></li>
                                                <li><a href="/admin/location-details" title="Location Details"><span>Location Details</span></a></li>

                                            </ul>
                                        </div>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);" title="Profile Settings">
                                            <i class="glyph-icon icon-linecons-cog"></i> <span>Profile Settings</span>
                                        </a>
                                        <div class="sidebar-submenu">
                                            <ul>
                                                <li><a href="/admin/edit-profile" title="Edit Profile"><span>Edit Profile</span></a></li>
                                            </ul>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div id="page-content-wrapper">
                        <div id="page-content">
                            <div id="page-header">
                                <div id="header-nav-left">
                                    <a class="header-btn" id="logout-btn"  title="Lockscreen page example"></a>
                                    <div class="user-account-btn dropdown">
                                        <a href="#" title="My Account" class="user-profile clearfix" data-toggle="dropdown"><img width="28" src="<?php echo $this->admindetails[0]['profilepic_url']; ?>" alt="Profile image"> <span><?php echo $this->session->storage->uname; ?></span> <i class="glyph-icon icon-angle-down"></i></a>
                                        <div class="dropdown-menu float-right">
                                            <div class="box-sm">
                                                <div class="login-box clearfix">
                                                    <div class="user-img"><a href="/admin/edit-profile" title="" class="change-img">Change photo</a> <img src="<?php echo $this->admindetails[0]['profilepic_url']; ?>" alt="Profile image"></div>
                                                    <div class="user-info"><span><?php echo $this->session->storage->uname; ?><i>CEO - Ziingo</i></span> <a href="/admin/edit-profile" title="Edit profile">Edit profile</a> <a href="/admin/notification" title="View notifications">View notifications</a></div>
                                                </div>
                                                <div class="divider"></div>
                                                <div class="button-pane button-pane-alt pad5L pad5R text-center">
                                                    <a href="/admin/logout" class="btn btn-flat display-block font-normal btn-danger">
                                                        <i class="glyph-icon icon-power-off"></i> Logout
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="header-nav-right">
                                    <div class="dropdown" id="notifications-btn"><a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true"><span class="small-badge bg-yellow" id="pending_noti_count"></span> <i class="glyph-icon icon-linecons-megaphone"></i></a>
                                        <div class="dropdown-menu box-md float-left">
                                            <div class="popover-title display-block clearfix pad10A">Notifications <a class="text-transform-cap font-primary font-normal btn-link float-right" href="#" title="View more options"></a></div>
                                            <div class="scrollable-content scrollable-slim-box">
                                                <ul class="no-border notifications-box">
                                                    <li class="external">
                                                        <h3  class="bold"><span id="total_pending_noti"></span> pending notifications</h3>
                                                        <!--                                                            <a href="/admin/notification">view all</a>-->
                                                    </li>
                                                    <li>
                                                        <ul class="dropdown-menu-list scroller" style="height: 250px;" data-handle-color="#637283" id="adminnotification"></ul>
                                                    </li>
                                                </ul>

                                            </div>
                                            <div class="button-pane button-pane-alt pad5T pad5L pad5R text-center"><a href="/admin/notification" class="btn btn-flat btn-primary" title="View all notifications">View all notifications</a></div>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <script type="text/javascript">
                                $(document).ready(function() {
                                    new get_notification();

                                    $(document.body).on("click", ".notimodaldescription", function() {
                                        var obj = $(this);
                                        var message = $(this).attr('data-desc');
                                        //var counts = $(this).attr('data-count');
                                        var count = $('#total_pending_noti').html();
                                        //  alert(count);
                                        $('#noti_message').html(message);
                                        // alert(counts - 1);
                                        var notificationId = $(this).attr('data-id');
                                        //alert(notificationId);
                                        $.ajax({
                                            url: '/admin/notification-ajax-handler',
                                            type: 'POST',
                                            datatype: 'json',
                                            data: {
                                                method: 'changeNotificationStatus',
                                                NotificationId: notificationId

                                            },
                                            success: function(response) {
                                                if (response) {
                                                    //alert(response);                         
                                                    obj.parent().hide();
                                                    var current_count = count - 1;
                                                    $('#total_pending_noti').html(current_count);
                                                    $('#pending_noti_count').html(current_count);
                                                }
                                            }
                                        });
                                    });
                                });
                                function get_notification() {
                                    var feedback = $.ajax({
                                        type: "POST",
                                        url: "/admin/notification-ajax-handler",
                                        data: {
                                            method: 'getuserNotification',
                                        },
                                        async: false
                                    }).success(function(data) {
                                        // id='count'
                                        var notifdata = jQuery.parseJSON(data);
                                        var notifics = notifdata[0];
                                        var noti = notifdata[1];
                                        //                        console.log(notifdata);
                                        //   alert(notifics);
                                        $("#adminnotification").empty();
                                        if (noti != null) {
                                            $.each(noti, function(index, value) {
                                                //alert(value['send_date']);
                                                var notiId = value['notification_id'];
                                                var message = value['notification_message'];
                                                var timestamp = value['sent_date'];
                                                var time = time_ago(timestamp);
                                                //                                                    alert(time);
                                                $("#adminnotification").append('<li><a data-desc="' + message + '" data-id=' + notiId + ' data-count=' + notifics + '  id="descmod"  class="notimodaldescription" data-toggle="modal" data-target="#adminnotimodal"><span class="time">' + time + '</span><span class="details" ><span class="label label-sm label-icon label-success"></span> <div class="dd-content">' + message + ' </div></span></a></li> ');
                                            });
                                        }

                                        $("#total_pending_noti").html(notifdata[0]);
                                        $("#pending_noti_count").html(notifdata[0]);
                                        setTimeout(function() {
                                            get_notification();
                                        }, 30000);
                                    })
                                    //   $('div.feedback-box').html(feedback);
                                }


                            </script>
                            <?php
                        }
                    }
                    ?>




