

<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            Contest Settings
            <small>for your next cool web APP</small>
        </h1>
        <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-futbol-o"></i> Home</a></li>
            <li>Contest Settings</li>
            <li class="active">Add New Contest</li>
        </ol>
    </section>

    <!-- Main content -->
    <section class="content">
        <!-- Info boxes -->
        <div class="row">
            <div class="col-md-12 col-sm-12 no-p-left no-p-right">
                <div class="panel panel-black no-radius">
                    <div class="panel-heading paddingLR-md paddingTB-sm no-radius">
                        <h3 class="font-Russo-One no-margin">Create New Contest</h3>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12 col-sm-12">
                <div class="panel panel-gray">
                    <div class="panel-heading paddingLR-md paddingTB-xs">
                        <h4 class="font-Libre-Baskerville inline-block"><span class="m-right-sm"><i class="fa fa-edit"></i></span>Manage Contest Details</h4>
                        <a class="btn btn-blue m-top-xs pull-right" href="/admin/contest-details">Contest Details</a>
                    </div>
                    <div class="panel-body padding-md">
                        <div class="row">
                            <div class="col-sm-8 col-xs-12 col-sm-offset-2 col-xs-offset-0">
                                <div class="form-group">
                                    <label for="sports">Sports</label>
                                    <div class="input-group col-xs-12">
                                        <select class="form-control" id="sports">
                                            <option value="" >Select Sport</option>
                                            <?php if (isset($this->sport)) {
                                                foreach ($this->sport as $sport) {
                                                    ?>
                                                    <option value="<?php echo $sport['sport_id']; ?>"><?php echo $sport['sport_name']; ?></option>
                                                <?php }
                                            }
                                            ?>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row" id="matchstats" style="display:none;">
                            <div class="col-md-12">
                                <div>
                                    <div class="table-responsive" style="height:300px">
                                        <table id="addNewContest" class="display table text-center" data-page-length="10" data-order="[[ 1, &quot;asc&quot; ]]" cellspacing="0" width="100%">
                                            <thead>
                                                <tr>
                                                    <td>S.no</td>
                                                    <td></td>
                                                    <th>Tournament name</th>
                                                    <th>Match start Date</th>
                                                    <th>Match End Date</th>

                                                </tr>
                                            </thead>
                                            <tbody>

                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div id="contestcolumnform" style="display:none;">
                            <form method = "POST" id="newContestForm">
                                <div class="row m-top-lg">
                                    <div class="col-md-6 col-sm-6">
                                        <div class="form-group">
                                            <label for="contestName">Contest Name <span>*</span></label>
                                            <div class="input-group col-xs-12">
                                                <input required class="form-control" type="text" id="contestName" name="contestName" value="">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="cType">Contest Type</label>
                                            <div class="input-group col-xs-12">
                                                <select required class="form-control" name="cType" id="cType">
                                                    <?php if (isset($this->contesttypes)) {
                                                        foreach ($this->contesttypes as $types) {
                                                            ?>
                                                            <option  value="<?php echo $types['con_type_id']; ?>"><?php echo $types['name']; ?></option>
    <?php }
}
?>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="scoringSystem">Scoring System</label>
                                            <div class="input-group col-xs-12">
                                                <select name="scoring_system">
                                                    <option value="1">1</option>
                                                    <option value="2">2</option>
                                                    <option value="3">3</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="pEntryLimit">Player (Entry Limit)</label>
                                            <div class="input-group col-xs-12">
                                                 <input required class="form-control" type="text" id="pEntryLimit" name="pEntryLimit" value="">
<!--                                                <select class="form-control" id="pEntryLimit" name="pEntryLimit" value="" >
                                                    <option   value="" selected="selected">select</option>
                                                </select>-->
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="entryFee">Entry Fee</label>
                                            <div class="input-group col-xs-12">
                                                <input required class="form-control" type="text" id="entryFee" name="entryFee" value="">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="matchID">Match ID</label>
                                            <select class="form-control" id="matchID" name="matchID">
                                                <option value="" selected="selected">select</option>
                                            </select>
                                            <div class="form-group m-top-md">
                                                <label for="seTicket">Set Entry Ticket <input class="m-left-md"  name="seTicket" id="seTicket" type="checkbox"> </label>
                                            </div>
                                            <div id="ticket-lists" style="display: none">
                                            <label for="ticket-list">Active Tickets</label>
                                            <select class="form-control" id="ticket-list" name="ticket-list">
                                                <?php if(isset($this->tickets)){
                                                 foreach($this->tickets as $value){?>
                                                <option value="<?php echo $value['ticket_id'];?>" selected="selected"><?php echo $value['ticket_name']."(".$value['ticket_code'].") valid from ".$value['valid_from']." to ".$value['valid_upto'];?></option>
                                                <?php }}?>
                                            </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6 col-sm-6">
                                        <div class="form-group">
                                            <label for="prizePool">Prize Pool</label>
                                            <div class="input-group col-xs-12">
                                                <input required class="form-control" type="text" name="prizePool" id="prizePool" value="">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="fppReward">FPP Reward</label>
                                            <div class="input-group col-xs-12">
                                                <input class="form-control" type="text" name="fppReward" id="fppReward" value="" readonly="">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="Time">Match Start Time</label>
                                            <div class="input-group col-xs-12">
                                                <input class="form-control" type="text" name="Time" id="Time" value= "" readonly="">                                           </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="endTime">Match End Time</label>
                                            <div class="input-group col-xs-12">
                                                <input class="form-control" type="text" name="endTime" id="endTime" value= "" readonly="">                                           </div>
                                        </div>

                                        <!--                                                <div class="form-group">
                                                                                                <label for="pType">Play Type</label>
                                                                                            <div class="input-group col-xs-12">
                                                                                                <select class="form-control" name="pType" id="pType">
                                                                                                    <option value="1" selected="">select</option>
                                                                                                        <option value="1" >Anyone</option>
                                                                                                    <option value="2">Friend</option>
                                                                                                </select>
                                                                                            </div>
                                                                                        </div>-->
                                        <div class="form-group">
                                            <label for="prizes">Prizes</label>
                                            <div class="input-group col-xs-12">
                                                <select class="form-control"  name ="prizes" id="prizes">
                                                    <option value="" selected="">selected</option>
                                                    <option value="1">Winners Takes All</option>
                                                    <option value="5">Custom Prizes</option>
                                                </select>
                                            </div>
                                        </div>
<!--                                        <div class="form-group">
                                            <label for="prizeRange">Prize Range</label>
                                            <div class="input-group col-xs-12">
                                                <input class="" type="text" name="rankFrom" id="rankFrom" value= "" placeholder="Rank From">
                                                <input class="" type="text" name="rankTo" id="rankTo" value= "" placeholder="Rank To">
                                                <input class="" type="text" name="prizePayout" id="prizePayout" value= "" placeholder="Prize payout">
                                            </div>
                                        </div>-->
                                        <div class="form-group">
                                            <label for="description">Description</label>
                                            <div class="input-group col-xs-12">
                                                <textarea required maxlength="650" class="form-control"  name="description" id="description">
                                                </textarea>
                                                <span class="font-10 block">(Maximum characters: 650)</span>
                                                <span class="font-10 block">You Have <span id="leftchar"class="font-14">650</span> Characters Left</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div >
                                    <div class="rankamt row" style="display: none">

                                    <div class="col-md-2">
                                        Rank From:
                                                <select class="rankFrom form-control"  name ="rankFrom[]" id="">
                                                    <option value="" selected="">selected</option>
                                                </select>
                                            </div>

                                    <div class="col-md-2">
                                        Rank To:
                                                <select class="rankTo form-control"  name ="rankTo[]" id="">
                                                    <option value="" selected="">selected</option>
                                                </select>
                                            </div>
                                        <div class="col-md-2">
                                        Prize type:
                                                <select class="prizeType form-control"  name ="prizeType[]" id="">
                                                    <option value="0" selected="">Select</option>
                                                    <option value="1">Amount</option>
                                                    <option value="2">Ticket</option>
                                                </select>
                                            </div>
                                        <div class="col-md-2 prizeAmount" style="display: none"><br>
                                        <input name ="prizeAmount[]" class="prizeAmount form-control" placeholder="Prize Amount">
                                            </div>
                                        <div class="col-md-2 prizeTicket" style="display: none"><br>
                                        <select name ="ticket[]" class="prizeTicket form-control" placeholder="Prize Amount">
                                            <?php if(isset($this->tickets)){
                                                 foreach($this->tickets as $value){?>
                                                <option value="<?php echo $value['ticket_id'];?>" selected="selected"><?php echo $value['ticket_name']."(".$value['ticket_code'].") valid from ".$value['valid_from']." to ".$value['valid_upto'];?></option>
                                                <?php }}?>
                                        </select>

                                </div>
                                        <div class="col-md-2"><br>
                                        <a class="add">Add</a>
                                            </div>
                                </div>

                                <div class="clearfix"></div>
                                <div class="m-top-md">
                                    <button class="btn btn-blue paddingLR-md">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>



    </section><!-- /.content -->
</div>

<script>
    /*
     * dev: priyanka varanasi
     * date : 12/05/2015
     * desc: to get the match time in show in text box based on the match id
     */
//    $(document.body).on('change', '#matchID', function () {
//        var matchId = $(this).val();
//        $('.matchsates').each(function (index, values) {
//            var match = $(this).children('.matchid').html();
//            if (matchId === match) {
//                var start = $(this).children('.starttime').html();
//                $('#Time').val(start);
//            }
//        });
//    });


    $('#cType').on('change', function (e) {
        var contesttype = $(this).val();
        $('#pEntryLimit').html('');
        var status = $('#cType option:selected').attr('data-con');
        $('#con-size').html('');
        if (status === '5 ' || status === '4') {
            for (var i = 3; i <= 20; i++) {
                var option = "<option value=" + i + ">" + i + "</option>";
                $('#pEntryLimit').append(option);
            }
        } else if (status == 3) {
            var option = "<option value=2>2</option>";
            $('#pEntryLimit').append(option);
        }
    });

    $('#pEntryLimit').on('change', function (e) {

        var size = parseInt($(this).val());
        var reminder = size % 2;
        $('#prizes').html('');
        $('#prizes').append('<option value=1>Winner Takes all</option>');
        $('#prizes').append('<option value=5>Custom Prizes</option>');
        if (size > 2) {
            $('#prizes').append('<option value=2>Top two win</option>');
        }
        if (size > 6) {
            $('#prizes').append('<option value=3>Top Five win</option>');
        }
        if (reminder == 0) {
            $('#prizes').append('<option value=4>50/50 win</option>');
        }

    });


    $('#sports').on('change', function () {

        var sportid = $(this).val();

        $.ajax({
            url: './player-details',
            dataType: 'json',
            type: 'POST',
            data: {
                method: 'getmatchplayerstats',
                data: sportid
            },
            beforeSend: function () {

            },
            success: function (response) {
                if (response) {

                    $('#matchstats').show();
                    $('#contestcolumnform').show();
                    $('table#addNewContest tbody').html('');
                    var i = 0;
                    $.each(response, function (index, value) {
                        $('table#addNewContest tbody').append('<tr class="matchsates"><td>' + i + '</td><td><input class="checkbox" data-endtime = "' + value.match_enddate + '"type="radio" name="starttime" data-start="'+ value.match_startdate +'"></td><td class="matchid">' + value.name + '</td><td class="starttime">' + value.match_startdate + '</td><td>' + value.match_enddate + '</td></tr>');
                        var option = "<option value=" + value.match_id + ">" + value.match_id + "</option>";
                        $('#matchID').append(option);
                        i++;
                    });
                } else {
                    $('table#addNewContest tbody').html('');
                    $('#matchstats').css('display', 'none');
                    $('#contestcolumnform').css('display', 'none');
                }
            }
        });

    });



</script>
<script>
/*
    * Developer         :Partha pratim Neog
    * Date              :13-6-2015
    * Desc              :OnClick functions for checkboxes to choose the earliest startdate and last endDate
    *                    of the selected tournaments.
     */

     var endTime = [];
     var startTime = [];
     var rankTrack = 0;
     var prizeTrack = 0;
     $(document).on('change', '.checkbox', function(){
         var dateEnd = $(this).attr("data-endtime");
         var dateStart = $(this).attr("data-start");
         $('#Time').val(dateStart);
         $('#endTime').val(dateEnd);

//         if($(this).is(":checked")){
//         endTime.push($(this).attr("data-endtime"));
//         startTime.push($(this).attr("data-start"));
//
//         //Sorting the arrays
//         endTime.sort(function(a,b){
//             return new Date(b) - new Date(a);
//           });
//         startTime.sort(function(a,b){
//             return new Date(b) - new Date(a);
//           });
//
//         //Choosing appropriate dates to fill in form
//         var reqEndTime = endTime[0];
//         var i = startTime.length-1;
//         var reqStartTime = startTime[i];
//          $('#Time').val(reqStartTime);
//          $('#endTime').val(reqEndTime);
//
//        }else{
//         endTime.pop($(this).attr("data-endtime"));
//         startTime.pop($(this).attr("data-start"));
//         //Sorting the arrays
//         endTime.sort(function(a,b){
//             return new Date(b) - new Date(a);
//           });
//         startTime.sort(function(a,b){
//             return new Date(b) - new Date(a);
//           });
//         //Choosing appropriate dates to fill in form
//         var reqEndTime = endTime[0];
//         var i = startTime.length-1;
//         var reqStartTime = startTime[i];
//         $('#Time').val(reqStartTime);
//         $('#endTime').val(reqEndTime);
//        }
     });

     //Code to show or hide Ticket list
     $(document).on('change', '#seTicket', function(){
         if($(this).is(":checked")){
         $("#ticket-lists").show();
     }else{
         $("#ticket-lists").hide();
     }
     });





     $(document).on('change', '#prizes', function(){
         var val = $(this).val();
         if(val == 5){
          $(".rankamt").show();
         var players = $("#pEntryLimit").val();
         var prizePool = $("#prizePool").val();

         if(players!="" && prizePool!=""){
             for(var i = 1+parseInt(rankTrack); i<=players; i++){
                $(".rankFrom").append("<option value=" + i + ">" + i + "</option>");

//                $(".rankTo").append("<option value=" + i+1 + ">" + i + "</option>");
             }



         }else{
             $(".rankamt").hide();
             alert("Player limit and Prize Pool needs to be set!");
         }
     }

     });


    $(document).on('change', '.rankFrom', function(){
        var players = $("#pEntryLimit").val();
        var i = parseInt($(this).val());

        for(var j = i; j<=players; j++){
        $(".rankTo").append("<option value=" + j + ">" + j + "</option>");
    }
    });

    $(document).on('change', '.rankTo', function(){
        rankTrack = $(this).val();
    })


    $(document).on('change', '.prizeType', function(){
        if($(this).val()==1){
            $(this).parent().next().show();
            $(this).parent().next().next().hide();
        }
        if($(this).val()==2){
            $(this).parent().next().hide();
            $(this).parent().next().next().show();
        }
        if($(this).val()==0){
            $(this).parent().next().hide();
            $(this).parent().next().next().hide();
        }
    })

    $(document).on('blur', '.prizeAmount', function(){

        var prizePool = $("#prizePool").val();
        var prize = $(this).val();
        var playerNumber = ($(".rankTo").val()-$(".rankFrom").val())+1;
        if((prize*playerNumber)+prizeTrack>prizePool){
            alert("Prize cannot be more than Prizepool");
            $(this).val("");
            console.log(prizeTrack);
        }else{

            prizeTrack = (prize*playerNumber)+prizeTrack;
            console.log(prizeTrack);
        }
    });


    $(document).on('click', '.add', function(){
        if(parseInt(rankTrack)>=$("#pEntryLimit").val()){
            alert("Entry limit reached");
        }else{
            $('#prizes').val(1).trigger("change");
            $(this).parent().parent().append('<div class="clearfix"></div><div class="rankamt" style="display: none"> <div class="col-md-2"> Rank From: <select class="rankFrom form-control" name ="rankFrom[]" id=""> <option value="" selected="">selected</option> </select> </div> <div class="col-md-2"> Rank To: <select class="rankTo form-control" name ="rankTo[]" id=""> <option value="" selected="">selected</option> </select> </div> <div class="col-md-2"> Prize type: <select class="prizeType form-control" name ="prizeType[]" id=""> <option value="0" selected="">Select</option> <option value="1">Amount</option> <option value="2">Ticket</option> </select> </div> <div class="col-md-2 prizeAmount" style="display: none"><br> <input name ="prizeAmount[]" class="prizeAmount form-control" placeholder="Prize Amount"> </div> <div class="col-md-2 prizeTicket" style="display: none"><br> <select name ="ticket[]" class="prizeTicket form-control" placeholder="Prize Amount"> <?php if(isset($this->tickets)){ foreach($this->tickets as $value){?> <option value="<?php echo $value['ticket_id'];?>" selected="selected"><?php echo $value['ticket_name']."(".$value['ticket_code'].") valid from ".$value['valid_from']." to ".$value['valid_upto'];?></option> <?php }}?> </select> </div> <div class="col-md-2"><br> <a class="add">Add</a> </div> </div>');
            $('#prizes').val(5).trigger("change");
    }
    });












    //Calculate fpp
    $("#prizePool").keyup(function(){
        var prize = $(this).val();
        var fpp = prize - (2/10)*prize;
    $("#fppReward").val(fpp);
    })

    //Calculate characters left
    $("#description").keyup(function(){
        var len = 650 - $(this).val().length;
        $("#leftchar").html(len);
    });

    $(document).ready(function(){
        $("#newContestForm").validate({
            rules: {
                Time: "required",
                endTime: "required"
            },
            messages: {
                Time:{
                    required: "Please select atleast one tournament"
                },
                endTime:{
                    required: "Please select atleast one tournament"
                }
            }

        });
    });
</script>